services:
  postgres-dev:
    image: postgres:15-alpine
    container_name: health_tracker_postgres_dev
    restart: unless-stopped
    env_file:
      - .env.windows
    ports:
      - "${POSTGRES_PORT:-5432}:5432"
    volumes:
      - postgres_data_dev:/var/lib/postgresql/data

  api-dev:
    build:
      context: .
      dockerfile: Dockerfile.api  # Используем отдельный Dockerfile
    container_name: health_tracker_api_dev
    restart: unless-stopped
    env_file:
      - .env.windows
    depends_on:
      - postgres-dev
    environment:
      POSTGRES_HOST: postgres-dev
      API_BASE_URL: http://localhost:8000
    ports:
      - "8000:8000"
    volumes:
      - ./app:/app/app
      - ./migrations:/app/migrations
      - ./main.py:/app/main.py

  bot-dev:
    build:
      context: .
      dockerfile: Dockerfile.bot  # Используем отдельный Dockerfile
    container_name: health_tracker_bot_dev
    restart: unless-stopped
    env_file:
      - .env.windows
    depends_on:
      - api-dev
    environment:
      API_BASE_URL: http://api-dev:8000
    volumes:
      - ./bot:/app/bot
      - ./app/api_client.py:/app/api_client.py

  pgadmin-dev:
    image: dpage/pgadmin4
    container_name: health_tracker_pgadmin_dev
    restart: unless-stopped
    environment:
      PGADMIN_DEFAULT_EMAIL: ${PGADMIN_EMAIL}
      PGADMIN_DEFAULT_PASSWORD: ${PGADMIN_PASSWORD}
    ports:
      - "${PGADMIN_PORT}:80"
    volumes:
      - pgadmin_data_dev:/var/lib/pgadmin

volumes:
  postgres_data_dev:
  pgadmin_data_dev: